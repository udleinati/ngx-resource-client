!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("util"),require("rxjs"),require("dexie"),require("@nguniversal/express-engine/tokens"),require("rxjs/operators"),require("rxjs/internal/util/noop"),require("lodash"),require("faker")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@angular/common/http","util","rxjs","dexie","@nguniversal/express-engine/tokens","rxjs/operators","rxjs/internal/util/noop","lodash","faker"],e):e(t["ngx-jsonapi"]={},t.ng.core,t.common,t.http,t.util,t.rxjs,t.Dexie,t.tokens,t.operators,t.noop,t.lodash,t.faker)}(this,function(t,n,c,u,o,s,e,i,d,a,r,l){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var h,p=(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),f=function(i,r){var n,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(i,a)}catch(t){e=[6,t],o=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},v=function(){this.number=1,this.total_resources=0,this.size=0,this.resources_per_page=0},g=(y.propagateLoaded=function(t,e){for(var i in t){var r=t[i];r instanceof A&&r.setLoaded(e&&r.builded)}},y);function y(){}var b=(m.prototype.applyParams=function(t,e){if(void 0===e&&(e={}),this.appendPath(t.getPrePath()),e.beforepath&&this.appendPath(e.beforepath),this.appendPath(t.getPath()),e.include&&this.setInclude(e.include),function(t){return void 0!==t.id||void 0!==t.include_get||void 0!==t.include_save}(e)&&e.include_get&&this.setInclude(this.includes.concat(e.include_get)),e.fields&&0<Object.keys(e.fields).length)for(var i in e.fields){var r="fields["+i+"]="+e.fields[i].join(",");this.get_params.push(r)}},m.prototype.appendPath=function(t){""!==t&&this.paths.push(t)},m.prototype.getForCache=function(){return this.paths.join("/")+this.get_params.join("/")},m.prototype.get=function(){var t=this.get_params.slice();return 0<this.includes.length&&t.push("include="+this.includes.join(",")),this.paths.join("/")+(0<t.length?rt.injectedServices.rsJsonapiConfig.params_separator+t.join("&"):"")},m.prototype.setInclude=function(t){this.includes=t},m);function m(){this.paths=[],this.includes=[],this.get_params=[]}var _=(w.json_array2resources_array_by_type=function(t){var e={},i={};for(var r in w.json_array2resources_array(t,e),e){var n=e[r];n.type in i||(i[n.type]={}),i[n.type][n.id]=n}return i},w.json2resource=function(t,e){if(w.getService(t.type))return w.procreate(t);n.isDevMode()&&console.warn("`"+t.type+"`","service not found on json2resource().","Use @Autoregister() on service and inject it on component.");var i=new S;return i.id=t.id,i.type=t.type,i},w.getService=function(t){return rt.me.getResourceService(t)},w.getServiceOrFail=function(t){return rt.me.getResourceServiceOrFail(t)},w.buildIncluded=function(t){return"included"in t&&t.included?w.json_array2resources_array_by_type(t.included):{}},w.procreate=function(t){"type"in t&&"id"in t||console.error("Jsonapi Resource is not correct",t);var e=L.getInstance().getOrCreateResource(t.type,t.id);return e.fill({data:t}),e.is_new=!1,e},w.json_array2resources_array=function(t,e){void 0===e&&(e={});for(var i=0,r=t;i<r.length;i++){var n=r[i],o=w.json2resource(n,!1);e[o.type+"_"+o.id]=o}},w);function w(){}var R=(j.prototype.buildRelationships=function(){for(var t in this.relationships_from){var e=this.relationships_from[t];this.relationships_dest[t]&&null===e.data&&(this.relationships_dest[t].data=null,this.relationships_dest[t].builded=!0,this.relationships_dest[t].is_loading=!1,this.relationships_dest[t].loaded=!0),e.data&&(this.relationships_dest[t]instanceof A?this.__buildRelationshipHasMany(e,t):this.relationships_dest[t]instanceof J&&this.__buildRelationshipHasOne(e,t))}},j.prototype.__buildRelationshipHasMany=function(t,e){if(0===t.data.length)return this.relationships_dest[e]=new A,void(this.relationships_dest[e].builded=!0);this.relationships_dest[e].fill(t)},j.prototype.__buildRelationshipHasOne=function(t,e){if("type"in t.data){if(this.relationships_dest[e].data||(this.relationships_dest[e].data=new S),t.data.id!==this.relationships_dest[e].data.id&&(this.relationships_dest[e].data=new S,this.relationships_dest[e].data.type=t.data.type),this.relationships_dest[e].data.id!==t.data.id||!this.relationships_dest[e].data.attributes||0===Object.keys(this.relationships_dest[e].data.attributes).length){var i=this.__buildRelationship(t.data);i?(this.relationships_dest[e].data=i,this.relationships_dest[e].builded=!0):(this.relationships_dest[e].data.id=t.data.id,this.relationships_dest[e].data.type=t.data.type)}}else this.relationships_dest[e].data=[]},j.prototype.__buildRelationship=function(t){if(t.type in this.included_resources&&t.id in this.included_resources[t.type]){var e=this.included_resources[t.type][t.id];return L.getInstance().setResource(e,!0),e}this.getService(t.type);var i=L.getInstance().getResource(t.type,t.id);if(i)return i},j);function j(t,e,i,r){this.getService=t,this.relationships_from=e,this.relationships_dest=i,this.included_resources=r}var S=(O.prototype.reset=function(){for(var t in this.id="",this.attributes={},this.is_new=!0,this.relationships)this.relationships[t]=this.relationships[t]instanceof A?new A:new J},O.prototype.toObject=function(t){var e,i={},r=[],n=[],o=(t=Object.assign({},k.ParamsResource,t)).include||[];for(var s in t.include_save&&(o=o.concat(t.include_save)),this.relationships){var a=this.relationships[s];if(a instanceof A){a.builded||a.data&&0!==a.data.length?i[s]={data:[]}:delete i[s];for(var c=0,u=a.data;c<u.length;c++){var d=u[c],l={id:d.id,type:d.type};i[s].data.push(l);var h=d.type+"_"+d.id;-1===n.indexOf(h)&&o&&-1!==o.indexOf(s)&&(n.push(h),r.push(d.toObject({}).data))}}else{if(null===a.data||void 0===a.data){i[s]={data:a.data};continue}a instanceof J||console.warn(a," is not DocumentCollection or DocumentResource");var p=a.data;if(a.data&&!("id"in a.data)&&0<Object.keys(a.data).length&&console.warn(s+" defined with hasMany:false, but I have a collection"),p.id&&p.type)i[s]={data:{id:p.id,type:p.type}};else if(!a.builded&&!p.id&&!p.type){delete i[s];continue}h=p.type+"_"+p.id,-1===n.indexOf(h)&&o&&-1!==o.indexOf(s)&&(n.push(h),r.push(p.toObject({}).data))}}this.getService()&&this.getService().parseToServer?(e=Object.assign({},this.attributes),this.getService().parseToServer(e)):e=this.attributes;var f={data:{type:this.type,id:this.id,attributes:e,relationships:i}};return this.meta&&(f.data.meta=this.meta),t.meta&&(f.meta=t.meta),0<r.length&&(f.included=r),f},O.prototype.fill=function(t){this.id=t.data.id||"",this.attributes=Object.assign({},this.attributes||{},t.data.attributes),this.data_resource=t,this.is_new=!1;var e=_.getService(t.data.type);if(!this.relationships&&e&&(this.relationships=(new e.resource).relationships),!e)return!1;if(Object.keys(this.attributes).length){var i=_.getService(this.type);i&&"parseFromServer"in i&&i.parseFromServer(this.attributes)}return"cache_last_update"in t.data&&(this.cache_last_update=t.data.cache_last_update),new R(_.getService,t.data.relationships||{},this.relationships,_.buildIncluded(t)).buildRelationships(),!0},O.prototype.addRelationship=function(t,e){var i=this.relationships[e||t.type];i instanceof A?i.replaceOrAdd(t):i.data=t},O.prototype.addRelationships=function(t,e){var i=this;if(0!==t.length){if(!(this.relationships[e]instanceof A))throw new Error("addRelationships require a DocumentCollection (hasMany) relation.");t.forEach(function(t){i.addRelationship(t,e)})}},O.prototype.removeRelationship=function(t,e){if(!(t in this.relationships))return!1;if(!("data"in this.relationships[t]))return!1;var i=this.relationships[t];return i instanceof A?(i.data=i.data.filter(function(t){return t.id!==e}),0===i.data.length&&(i.builded=!0)):i.data=null,!0},O.prototype.hasManyRelated=function(t){return this.relationships[t]&&0<this.relationships[t].data.length},O.prototype.hasOneRelated=function(t){return Boolean(this.relationships[t]&&this.relationships[t].data.type&&""!==this.relationships[t].data.type)},O.prototype.restore=function(t){return void 0===t&&(t={}),t.meta=Object.assign({},t.meta,{restore:!0}),this.save(t)},O.prototype.getService=function(){return _.getServiceOrFail(this.type)},O.prototype.delete=function(){return this.getService().delete(this.id)},O.prototype.save=function(t){var e=this;if(t=Object.assign({},k.ParamsResource,t),this.is_saving||!this.loaded)return s.of({});this.is_saving=!0;var i=new s.Subject,r=this.toObject(t);""===this.id&&delete r.data.id;var n=new b;return n.applyParams(this.getService(),t),this.id&&n.appendPath(this.id),rt.exec(n.get(),this.is_new?"POST":"PATCH",r,!0).subscribe(function(t){e.is_saving=!1,e.id||(L.getInstance().deprecateCollections(n.get()),(new z).deprecateCollection(n.get())),"id"in t.data?(e.id=t.data.id,e.fill(t)):o.isArray(t.data)&&console.warn("Server return a collection when we save()",t.data),i.next(t),i.complete()},function(t){e.is_saving=!1,i.error("data"in t?t.data:t)}),i.asObservable()},O.prototype.setLoaded=function(t){this.is_loading=!t,this.loaded=t},O.prototype.setLoadedAndPropagate=function(t){this.setLoaded(t),g.propagateLoaded(this.relationships,t)},O.prototype.setSource=function(t){this.source=t},O.prototype.setSourceAndPropagate=function(t){for(var e in this.setSource(t),this.relationships){var i=this.relationships[e];i instanceof A&&i.setSource(t)}},O.prototype.setCacheLastUpdate=function(t){void 0===t&&(t=Date.now()),this.cache_last_update=t},O);function O(){this.id="",this.type="",this.attributes={},this.relationships={},this.links={},this.is_new=!0,this.is_saving=!1,this.is_loading=!1,this.loaded=!0,this.source="new",this.cache_last_update=0,this.ttl=0}function C(){this.builded=!1,this.is_loading=!0,this.loaded=!1,this.source="new",this.cache_last_update=0,this.meta={}}var P,D=(p(E,P=C),E.prototype.trackBy=function(t){return t.id},E.prototype.find=function(t){if("ids"===this.content)return null;for(var e=0;e<this.data.length;e++)if(this.data[e].id===t)return this.data[e];return null},E.prototype.fill=function(t){this.data_collection=t,_.buildIncluded(t),this.page&&t.meta&&(this.page.number=t.meta.page||1,this.page.resources_per_page=t.meta.resources_per_page||null,this.page.size=t.meta.resources_per_page||null,this.page.total_resources=t.meta.total_resources||null);var e={};this.data.length=0,this.builded=t.data&&0===t.data.length;for(var i=0,r=t.data;i<r.length;i++){var n=r[i];try{var o=this.getResourceOrFail(n);o.fill({data:n}),e[n.id]=n.id,this.data.push(o),0<Object.keys(o.attributes).length&&(this.builded=!0)}catch(t){this.content="ids",this.builded=!1,this.data.push({id:n.id,type:n.type})}}for(var s=void 0;s<this.data.length;s++)this.data[s].id in e||delete this.data[s];this.meta=t.meta||{},"cache_last_update"in t&&(this.cache_last_update=t.cache_last_update)},E.prototype.getResourceOrFail=function(t){var e=this.find(t.id);if(null!==e)return e;var i=_.getService(t.type);if(!i)throw n.isDevMode()&&console.warn("The relationship relation_alias? (type "+t.type+") cant be generated because service for this type has not been injected."),new Error("Cant create service for "+t.type);return i.getOrCreateResource(t.id)},E.prototype.replaceOrAdd=function(t){var e=this.find(t.id);null===e?this.data.push(t):e=t},E.prototype.hasMorePages=function(){return!this.page.size||this.page.size<1?null:this.page.size*(this.page.number-1)+this.data.length<this.page.total_resources},E.prototype.setLoaded=function(t){this.is_loading=!t,this.loaded=t},E.prototype.setLoadedAndPropagate=function(e){this.setLoaded(e),"ids"!==this.content&&this.data.forEach(function(t){g.propagateLoaded(t.relationships,e)})},E.prototype.setBuilded=function(t){this.builded=t},E.prototype.setBuildedAndPropagate=function(e){this.setBuilded(e),"ids"!==this.content&&this.data.forEach(function(t){t.setLoaded(e)})},E.prototype.setSource=function(t){this.source=t},E.prototype.setSourceAndPropagate=function(e){this.setSource(e),this.data.forEach(function(t){t instanceof S&&t.setSource(e)})},E.prototype.setCacheLastUpdate=function(t){void 0===t&&(t=Date.now()),this.cache_last_update=t},E.prototype.setCacheLastUpdateAndPropagate=function(e){void 0===e&&(e=Date.now()),this.setCacheLastUpdate(e),this.data.forEach(function(t){t instanceof S&&t.setCacheLastUpdate(e)})},E.prototype.toObject=function(e){return this.builded?{data:this.data.map(function(t){return t.toObject(e).data})}:{data:this.data}},E);function E(){var t=P.apply(this,arguments)||this;return t.data=[],t.page=new v,t.ttl=0,t.content="ids",t}var x,A=(p(F,x=D),F);function F(){var t=x.apply(this,arguments)||this;return t.data=[],t.content="collection",t}var k=(I.newCollection=function(){return new A},I.isObjectLive=function(t,e){return 0<=t&&Date.now()<=e+1e3*t},I.forEach=function(e,i){Object.keys(e).forEach(function(t){i(e[t],t)})},I);function I(){}k.ParamsResource={beforepath:"",ttl:void 0,include:[],fields:{},id:""},k.ParamsCollection={beforepath:"",ttl:void 0,include:[],remotefilter:{},fields:{},smartfilter:{},sort:[],page:new v,store_cache_method:"individual",storage_ttl:0,cachehash:""};var L=(T.getInstance=function(){return T.instance||(T.instance=new T),T.instance},T.prototype.clearCache=function(){this.resources={},this.collections={},T.instance=null},T.prototype.getResource=function(t,e){return this.getKey(t,e)in this.resources?this.resources[this.getKey(t,e)]:null},T.prototype.getResourceOrFail=function(t,e){if(this.getKey(t,e)in this.resources)return this.resources[this.getKey(t,e)];throw new Error("The requested resource does not exist in cache memory")},T.prototype.getKey=function(t,e){return t+"."+e},T.prototype.getOrCreateCollection=function(t){return t in this.collections||(this.collections[t]=new A,this.collections[t].source="new"),this.collections[t]},T.prototype.setCollection=function(t,e){t in this.collections||(this.collections[t]=new A);for(var i=0;i<e.data.length;i++){var r=e.data[i];this.setResource(r,!0)}this.collections[t].data=e.data,this.collections[t].page=e.page,this.collections[t].cache_last_update=e.cache_last_update},T.prototype.getOrCreateResource=function(t,e){var i=this.getResource(t,e);return null!==i||((i=_.getServiceOrFail(t).new()).id=e,this.setResource(i,!1)),i},T.prototype.setResource=function(t,e){void 0===e&&(e=!1),this.getKey(t.type,t.id)in this.resources?this.fillExistentResource(t):this.resources[this.getKey(t.type,t.id)]=t,this.resources[this.getKey(t.type,t.id)].cache_last_update=e?Date.now():0},T.prototype.deprecateCollections=function(t){for(var e in void 0===t&&(t=""),this.collections)e.includes(t)&&(this.collections[e].cache_last_update=0);return!0},T.prototype.removeResource=function(i,r){var t=this.getResource(i,r);if(t){for(var e in k.forEach(this.collections,function(t,e){t.data.splice(t.data.findIndex(function(t){return t.type===i&&t.id===r}),1)}),t.attributes={},t.relationships)null!==t.relationships[e].data&&void 0!==t.relationships[e].data&&(t.relationships[e].data instanceof Array?t.relationships[e].data=[]:t.relationships[e].data instanceof Object&&delete t.relationships[e].data);delete this.resources[this.getKey(i,r)]}},T.prototype.fillExistentResource=function(t){var e=this.getResourceOrFail(t.type,t.id);e.attributes=Object.assign({},e.attributes,t.attributes),e.relationships=e.relationships||t.relationships},T);function T(){this.resources={},this.collections={}}var q,J=(p(M,q=C),M.prototype.fill=function(t){this.builded=!1,this.content="id",null!==(this.data_resource=t)?(this.data||(this.data=L.getInstance().getOrCreateResource(t.data.type,t.data.id)),this.data.fill(t)&&(this.builded=!0,this.content="resource"),this.meta=t.meta||{}):this.data=null},M.prototype.unsetData=function(){this.data=void 0,this.builded=!1},M);function M(){var t=q.apply(this,arguments)||this;return t.data=new S,t.builded=!1,t.content="id",t}var K=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})},H=(B.prototype.getElement=function(i,r){return void 0===r&&(r="elements"),K(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return[4,B.db.open()];case 1:return t.sent(),[4,B.db.table(r).get(i)];case 2:if(void 0===(e=t.sent()))throw new Error(i+" not found.");return[2,e]}})})},B.prototype.getElements=function(i,r){return void 0===r&&(r="elements"),K(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return e={},[4,B.db.table(r).where(":id").anyOf(i).each(function(t){e[t.data.type+"."+t.data.id]=t})];case 1:return t.sent(),[2,i.map(function(t){return e[t]})]}})})},B.prototype.updateElements=function(i,t,r){return void 0===r&&(r="elements"),K(this,void 0,void 0,function(){var e=this;return f(this,function(t){return[2,B.db.open().then(function(){return K(e,void 0,void 0,function(){return f(this,function(t){return""===i?[2,B.db.table(r).clear()]:[2,B.db.table(r).where(":id").startsWith(i).delete().then(function(){})]})})})]})})},B.prototype.saveElements=function(r,n){return void 0===n&&(n="elements"),K(this,void 0,void 0,function(){var e,i;return f(this,function(t){return e=[],i=r.map(function(t){return e.push(t.key),t.content}),[2,B.db.open().then(function(){B.db.table(n).bulkPut(i,e)})]})})},B);function B(){B.db||(B.db=new e("dexie_data_provider")).version(1).stores({collections:"",elements:""})}var W=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})};var z=(G.prototype.getResource=function(n,o){return void 0===o&&(o=[]),W(this,void 0,void 0,function(){var i,r,e;return f(this,function(t){switch(t.label){case 0:return[4,this.getDataResources([n])];case 1:if(void 0===(i=t.sent().shift()))throw new Error("Resource "+n+" don't found.");return 0===o.length?[2,i]:(r=[],o.forEach(function(t){if(!i||!i.data.relationships||!i.data.relationships[t])throw new Error("We dont have relation_alias on stored data resource");var e=i.data.relationships[t].data;e instanceof Array?e.forEach(function(t){r.push(G.getResourceKey(t))}):e&&"id"in e&&r.push(G.getResourceKey(e))}),[4,this.getDataResources(r)]);case 2:return e=t.sent(),[2,Object.assign({},i,{included:e.map(function(t){return t.data})})]}})})},G.prototype.getCollection=function(s,a){return void 0===a&&(a=[]),W(this,void 0,void 0,function(){var e,r,i,n,o;return f(this,function(t){switch(t.label){case 0:return[4,this.getDataCollection(s)];case 1:return e=t.sent(),[4,this.getDataResources(e.keys)];case 2:return r=t.sent(),i={data:r.map(function(t){return t.data}),cache_last_update:e.updated_at},0===a.length?[2,i]:(n=[],a.forEach(function(i){r.forEach(function(t){if(t.data.relationships&&t.data.relationships[i]){var e=t.data.relationships[i].data;e instanceof Array?e.forEach(function(t){n.push(G.getResourceKey(t))}):"id"in e&&n.push(G.getResourceKey(e))}})}),[4,this.getDataResources(n)]);case 3:return o=t.sent(),[2,Object.assign({},i,{included:o.map(function(t){return t.data})})]}})})},G.prototype.getDataCollection=function(e){return W(this,void 0,void 0,function(){return f(this,function(t){return[2,this.dataProvider.getElement(e,"collections")]})})},G.prototype.getDataResources=function(e){return W(this,void 0,void 0,function(){return f(this,function(t){return[2,this.dataProvider.getElements(e,"elements")]})})},G.prototype.saveCollection=function(t,e,i){void 0===i&&(i=[]),this.dataProvider.saveElements(G.collectionToElement(t,e),"collections"),this.dataProvider.saveElements(G.collectionResourcesToElements(e,i),"elements")},G.prototype.saveResource=function(e,i){return void 0===i&&(i=[]),W(this,void 0,void 0,function(){return f(this,function(t){return[2,this.dataProvider.saveElements(G.toResourceElements(G.getResourceKey(e),e,i),"elements")]})})},G.collectionToElement=function(t,e){var i={key:t,content:{updated_at:Date.now(),keys:[]}};return e.data.forEach(function(t){var e=G.getResourceKey(t);i.content.keys.push(e)}),[i]},G.collectionResourcesToElements=function(t,i){void 0===i&&(i=[]);var r=[];return t.data.forEach(function(t){var e=G.getResourceKey(t);r.push.apply(r,G.toResourceElements(e,t,i))}),r},G.toResourceElements=function(t,i,e){void 0===e&&(e=[]);var r=[{key:t,content:i.toObject()}];return r[0].content.data.cache_last_update=Date.now(),e.forEach(function(t){var e=i.relationships[t];if(e instanceof A)e.data.forEach(function(t){r.push(G.getElement(t))});else if(e instanceof J){if(null===e.data||void 0===e.data)return;r.push(G.getElement(e.data))}}),r},G.getResourceKey=function(t){return t.type+"."+t.id},G.getElement=function(t){return{key:G.getResourceKey(t),content:t.toObject()}},G.prototype.deprecateCollection=function(e){return W(this,void 0,void 0,function(){return f(this,function(t){return[2,this.dataProvider.updateElements(e,{},"collections")]})})},G);function G(){this.dataProvider=new H}function U(t,e){var i=e&&"number"==typeof e?e:t.ttl||0;return Date.now()<t.cache_last_update+1e3*i}function N(t,e,i){var r=i.value;return i.value=function(){var t,e=Array.prototype.slice.call(arguments);try{t="string"==typeof e[0]?e[0]:e[0].type}catch(t){return console.warn("ERROR: First argument of methods decorated with serviceIsRegistered has to be string or Resource."),null}return rt.me.getResourceService(t)?r.apply(this,e):(console.warn("ERROR: "+t+" service has not been registered."),null)},i}var Q=function(){this.url="http://yourdomain/api/v1/",this.params_separator="?",this.unify_concurrency=!0,this.cache_prerequests=!0,this.cachestore_support=!0,this.parameters={page:{number:"page[number]",size:"page[size]"}}},V=(X.prototype.exec=function(t,e,i){var r=this,n=this.rsJsonapiConfig.url,o={body:i||null,headers:new u.HttpHeaders({"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"})};if(c.isPlatformServer(this.platformId)&&!n.match(/^http\:|^https\:|^\/\//)){var s=this.request.headers;n=(s["x-forwarded-proto"]?s["x-forwarded-proto"].split(",")[0]:s.proto?s.proto:"http")+"://"+(s["x-forwarded-host"]?s["x-forwarded-host"].split(",")[0]:s.host)+n}if("get"!==e)return this.http.request(e,n+t,o).pipe(d.tap(function(){delete r.get_requests[t]}),d.share());if(this.get_requests[t])return this.get_requests[t];var a=this.http.request(e,n+t,o).pipe(d.tap(function(){delete r.get_requests[t]}),d.share());return this.get_requests[t]=a},X);function X(t,e,i,r){this.request=t,this.platformId=e,this.http=i,this.rsJsonapiConfig=r,this.get_requests={}}V.decorators=[{type:n.Injectable}],V.ctorParameters=function(){return[{type:void 0,decorators:[{type:n.Optional},{type:n.Inject,args:[i.REQUEST]}]},{type:void 0,decorators:[{type:n.Inject,args:[n.PLATFORM_ID]}]},{type:u.HttpClient},{type:Q}]};var Y=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})};var Z=($.prototype.getDataObject=function(r,n){return Y(this,void 0,void 0,function(){var e,i;return f(this,function(t){switch(t.label){case 0:return e="collection"===r?"collections":"elements",[4,this.db.open()];case 1:return t.sent(),[4,this.db.table(e).get(r+"."+n)];case 2:if(void 0===(i=t.sent()))throw new Error;return[2,i]}})})},$.prototype.getDataResources=function(r){return Y(this,void 0,void 0,function(){var e,i;return f(this,function(t){switch(t.label){case 0:return e=this.db.table("elements").where(":id").anyOf(r),i={},[4,e.each(function(t){i[t.id]=t})];case 1:return t.sent(),[2,i]}})})},$.prototype.saveResource=function(e,i,t){var r=this,n=Object.assign({cache_last_update:Date.now()},t);this.db.open().then(function(){return Y(r,void 0,void 0,function(){return f(this,function(t){return[2,this.db.table("elements").put(n,e+"."+i)]})})})},$.prototype.saveCollection=function(e,t){var i=this,r=Object.assign({cache_last_update:Date.now()},t);this.db.open().then(function(){return Y(i,void 0,void 0,function(){return f(this,function(t){return[2,this.db.table("collections").put(r,"collection."+e)]})})})},$.prototype.clearCache=function(){var t=this;this.db.open().then(function(){return Y(t,void 0,void 0,function(){return f(this,function(t){return[2,this.db.table("elements").toCollection().delete()]})})}),this.db.open().then(function(){return Y(t,void 0,void 0,function(){return f(this,function(t){return[2,this.db.table("collections").toCollection().delete()]})})})},$.prototype.deprecateResource=function(e,i){var t=this;this.db.open().then(function(){return Y(t,void 0,void 0,function(){return f(this,function(t){return[2,this.db.table("elements").where(":id").startsWith(e+"."+i).modify({cache_last_update:0})]})})})},$.prototype.deprecateCollection=function(e){var t=this;this.db.open().then(function(){return Y(t,void 0,void 0,function(){return f(this,function(t){return[2,this.db.table("collections").where(":id").startsWith(e).modify({cache_last_update:0})]})})})},$.prototype.removeObjectsWithKey=function(t){return Y(this,void 0,void 0,function(){return f(this,function(t){return[2]})})},$.prototype.checkIfIsTimeToClean=function(){},$.prototype.checkAndDeleteOldElements=function(){},$);function $(){this.db=new e("jsonapi_db"),this.db.version(1).stores({collections:"",elements:""}),this.checkIfIsTimeToClean()}var tt=function(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(s=(o<3?n(s):3<o?n(e,i,s):n(e,i))||s);return 3<o&&s&&Object.defineProperty(e,i,s),s},et=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},it=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})},rt=(nt.delete=function(t){return nt.exec(t,"DELETE")},nt.get=function(t){return nt.exec(t,"get")},nt.exec=function(t,e,i,r){return void 0===r&&(r=!0),nt.me.refreshLoadings(1),nt.injectedServices.JsonapiHttp.exec(t,e,i).pipe(d.tap(function(){return nt.me.refreshLoadings(-1)}),d.catchError(function(t){return t=t.error||t,nt.me.refreshLoadings(-1),t.status<=0?!nt.me.loadingsOffline(t)&&n.isDevMode()&&console.warn("Jsonapi.Http.exec (use JsonapiCore.loadingsOffline for catch it) error =>",t):r&&!nt.me.loadingsError(t)&&n.isDevMode()&&console.warn("Jsonapi.Http.exec (use JsonapiCore.loadingsError for catch it) error =>",t),s.throwError(t)}))},nt.prototype.registerService=function(t){return!(t.type in this.resourceServices)&&(this.resourceServices[t.type]=t)},nt.prototype.getResourceService=function(t){return this.resourceServices[t]},nt.prototype.getResourceServiceOrFail=function(t){var e=this.resourceServices[t];if(!e)throw new Error("The requested service with type "+t+" has not been registered, please use register() method or @Autoregister() decorator");return e},nt.removeCachedResource=function(t,e){L.getInstance().removeResource(t,e)},nt.setCachedResource=function(t){L.getInstance().setResource(t,!0)},nt.deprecateCachedCollections=function(t){var e=nt.me.getResourceServiceOrFail(t),i=new b;i.applyParams(e),L.getInstance().deprecateCollections(i.getForCache())},nt.prototype.refreshLoadings=function(t){this.loadingsCounter+=t,0===this.loadingsCounter?this.loadingsDone():1===this.loadingsCounter&&this.loadingsStart()},nt.prototype.clearCache=function(){return it(this,void 0,void 0,function(){return f(this,function(t){return nt.injectedServices.JsonapiStoreService.clearCache(),L.getInstance().clearCache(),[2,(new z).deprecateCollection("").then(function(){return!0})]})})},nt.prototype.duplicateResource=function(i){for(var r=this,n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var o=this.getResourceServiceOrFail(i.type).new();function e(e){var t=i.relationships[e];if(!t.data)return o.relationships[e]=i.relationships[e],"continue";"id"in t.data?-1<n.indexOf(e)?o.addRelationship(s.duplicateResource(t.data),e):o.addRelationship(t.data,e):-1<n.indexOf(e)?t.data.forEach(function(t){o.addRelationship(r.duplicateResource(t),e)}):o.addRelationships(t.data,e)}o.id="new_"+Math.floor(1e4*Math.random()).toString(),o.attributes=Object.assign({},o.attributes,i.attributes);var s=this;for(var a in i.relationships)e(a);return o},nt);function nt(t,e,i){for(var r in this.loadingsCounter=0,this.loadingsStart=a.noop,this.loadingsDone=a.noop,this.loadingsError=a.noop,this.loadingsOffline=a.noop,this.resourceServices={},this.config=new Q,this.config)this.config[r]=void 0!==t[r]?t[r]:this.config[r];nt.me=this,nt.injectedServices={JsonapiStoreService:e,JsonapiHttp:i,rsJsonapiConfig:this.config}}rt.decorators=[{type:n.Injectable}],rt.ctorParameters=function(){return[{type:Q,decorators:[{type:n.Optional}]},{type:Z},{type:V}]},tt([N,et("design:type",Function),et("design:paramtypes",[String,String]),et("design:returntype",void 0)],rt,"removeCachedResource",null),tt([N,et("design:type",Function),et("design:paramtypes",[S]),et("design:returntype",void 0)],rt,"setCachedResource",null),tt([N,et("design:type",Function),et("design:paramtypes",[String]),et("design:returntype",void 0)],rt,"deprecateCachedCollections",null);var ot=(st.forRoot=function(t){return{ngModule:st,providers:[{provide:Q,useValue:t}]}},st);function st(t,e){if(t)throw new Error("NgxJsonapiModule is already loaded. Import it in the AppModule only")}ot.decorators=[{type:n.NgModule,args:[{imports:[c.CommonModule],exports:[u.HttpClientModule],providers:[rt,Z,Q,V]}]}],ot.ctorParameters=function(){return[{type:ot,decorators:[{type:n.Optional},{type:n.SkipSelf}]},{type:rt}]};var at=(ct.prototype.toparams=function(t){var i=this,r="";return k.forEach(t,function(t,e){r+=i.toparamsarray(t,"&"+e)}),r.slice(1)},ct.prototype.toparamsarray=function(t,i){var r=this,n="";return Array.isArray(t)?k.forEach(t,function(t,e){n+=i+"[]="+t}):o.isObject(t)?k.forEach(t,function(t,e){n+=r.toparamsarray(t,i+"["+e+"]")}):n+=i+"="+t,n},ct);function ct(){}var ut,dt=(p(lt,ut=b),lt.prototype.applyParams=function(t,e){void 0===e&&(e={}),ut.prototype.applyParams.call(this,t,e);var i=new at;e.remotefilter&&0<Object.keys(e.remotefilter).length&&(t.parseToServer&&t.parseToServer(e.remotefilter),this.addParam(i.toparams({filter:e.remotefilter}))),e.page&&(1<e.page.number&&this.addParam(this.getPageConfig().number+"="+e.page.number),e.page.size&&this.addParam(this.getPageConfig().size+"="+e.page.size)),e.sort&&e.sort.length&&this.addParam("sort="+e.sort.join(","))},lt.prototype.getPageConfig=function(){return rt.injectedServices.rsJsonapiConfig.parameters&&rt.injectedServices.rsJsonapiConfig.parameters.page||{number:"number",size:"size"}},lt.prototype.addParam=function(t){this.get_params.push(t)},lt);function lt(){return null!==ut&&ut.apply(this,arguments)||this}var ht=(pt.prototype.getResourceObject=function(){return this.resource_object},pt.prototype.removeDuplicatedIncludes=function(){if(!this.resource_object.included||!this.parent_resource_object.included)return this;var t=this.parent_resource_object.included;return this.resource_object.included=this.resource_object.included.filter(function(e){return!r.isEqual(e,t.find(function(t){return t.id===e.id}))}),this.resource_object.included=this.resource_object.included.map(function(e){return t.find(function(t){return t.id===e.id})?new pt(e,t.find(function(t){return t.id===e.id})).getResourceObject().data:e}),this},pt.prototype.removeDuplicatedRelationships=function(){if(!this.resource_object.data.relationships||!this.parent_resource_object.data.relationships)return this;for(var t in this.resource_object.data.relationships)r.isEqual(this.resource_object.data.relationships[t],this.parent_resource_object.data.relationships[t])&&delete this.resource_object.data.relationships[t];return this},pt.prototype.removeDuplicatedAttributes=function(){if(!this.resource_object.data.attributes||!this.parent_resource_object.data.attributes)return this;for(var t in this.resource_object.data.attributes)this.resource_object.data.attributes[t]===this.parent_resource_object.data.attributes[t]&&delete this.resource_object.data.attributes[t];return this},pt);function pt(t,e,i){this.parent_resource_object=e instanceof S?e.toObject(i):{data:e},!function(t){return t&&t.toObject&&"function"==typeof t.toObject&&t.superToObject&&"function"==typeof t.superToObject}(t)?this.resource_object={data:t}:this.resource_object=t.superToObject(i),this.removeDuplicatedAttributes(),this.removeDuplicatedRelationships(),this.removeDuplicatedIncludes()}var ft,vt=(p(gt,ft=S),gt.prototype.toObject=function(t){return new ht(this,this.parent,t).getResourceObject()},gt.prototype.superToObject=function(t){return ft.prototype.toObject.call(this,t)},gt.prototype.copySourceFromParent=function(){for(var t in this.source=this.parent.source,this.relationships)this.relationships[t].source=this.parent.relationships[t].source},gt);function gt(t){var e=ft.call(this)||this;e.parent=r.cloneDeep(t),e.type=e.parent.type,delete e.relationships;var i=Object.keys(e.parent.relationships);return e.fill(e.parent.toObject({include:i})),e.copySourceFromParent(),e}var yt=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})},bt=(mt.prototype.register=function(){if(null===rt.me)throw new Error("Error: you are trying register `"+this.type+"` before inject JsonapiCore somewhere, almost one time.");return rt.me.registerService(this)},mt.prototype.newResource=function(){return this.new()},mt.prototype.newCollection=function(){return new A},mt.prototype.new=function(){var t=new this.resource;return t.type=this.type,this.getService(),t.reset(),t},mt.prototype.getPrePath=function(){return""},mt.prototype.getPath=function(){return this.path||this.type},mt.prototype.getClone=function(t,e){return void 0===e&&(e={}),this.get(t,e).pipe(d.map(function(t){return new vt(t)}))},mt.prototype.pathForGet=function(t,e){void 0===e&&(e={}),e=Object.assign({},k.ParamsResource,e);var i=new b;return i.applyParams(this,e),i.appendPath(t),i.get()},mt.prototype.get=function(t,e){var i=this;void 0===e&&(e={}),e=Object.assign({},k.ParamsResource,e);var r=new b;r.applyParams(this,e),r.appendPath(t);var n=this.getOrCreateResource(t);n.setLoaded(!1);var o=new s.BehaviorSubject(n);return 0<Object.keys(e.fields||[]).length?this.getGetFromServer(r,n,o):U(n,e.ttl)&&function(t,e){if(0===e.length)return!0;for(var i in t.relationships)if(e.includes(i)&&!t.relationships[i].builded)return!1;return!0}(n,e.include||[])?(n.setLoaded(!0),setTimeout(function(){return o.complete()},0)):0===n.cache_last_update?this.getGetFromLocal(e,r,n).then(function(){o.next(n),setTimeout(function(){return o.complete()},0)}).catch(function(){n.setLoaded(!1),i.getGetFromServer(r,n,o)}):this.getGetFromServer(r,n,o),o.asObservable()},mt.prototype.getGetFromLocal=function(i,r,n){return void 0===i&&(i={}),yt(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:if(!rt.injectedServices.rsJsonapiConfig.cachestore_support)throw new Error("We cant handle this request");return n.setLoaded(!1),[4,(new z).getResource(z.getResourceKey(n),r.includes)];case 1:if(e=t.sent(),n.fill(e),n.setSource("store"),U(n,i.ttl))return n.setLoadedAndPropagate(!0),[2];throw new Error("Resource is dead!")}})})},mt.prototype.getGetFromServer=function(e,i,r){rt.get(e.get()).subscribe(function(t){i.fill(t),i.cache_last_update=Date.now(),i.setLoadedAndPropagate(!0),i.setSourceAndPropagate("server"),rt.injectedServices.rsJsonapiConfig.cachestore_support&&(new z).saveResource(i,e.includes),r.next(i),setTimeout(function(){return r.complete()},0)},function(t){i.setLoadedAndPropagate(!0),r.next(i),r.error(t)})},mt.prototype.getService=function(){return _.getService(this.type)||this.register()},mt.prototype.getOrCreateCollection=function(t){var e=this.getService(),i=L.getInstance().getOrCreateCollection(t.getForCache());return i.ttl=e.collections_ttl,"new"!==i.source&&(i.source="memory"),i},mt.prototype.getOrCreateResource=function(t){var e,i=this.getService();return null===(e=L.getInstance().getResource(this.type,t))&&((e=i.new()).id=t,L.getInstance().setResource(e,!1)),"new"!==e.source&&(e.source="memory"),e},mt.prototype.createResource=function(t){var e=_.getServiceOrFail(this.type).new();return e.id=t,L.getInstance().setResource(e,!1),e},mt.prototype.clearCacheMemory=function(){return yt(this,void 0,void 0,function(){return f(this,function(t){return[2,this.clearCache()]})})},mt.prototype.clearCache=function(){return yt(this,void 0,void 0,function(){var e;return f(this,function(t){return(e=new b).applyParams(this),L.getInstance().deprecateCollections(e.getForCache()),[2,(new z).deprecateCollection(e.getForCache()).then(function(){return!0})]})})},mt.prototype.parseToServer=function(t){},mt.prototype.parseFromServer=function(t){},mt.prototype.delete=function(e,t){var i=this;t=Object.assign({},k.ParamsResource,t);var r=new b;r.applyParams(this,t),r.appendPath(e);var n=new s.Subject;return rt.delete(r.get()).subscribe(function(t){L.getInstance().removeResource(i.type,e),n.next(),n.complete()},function(t){n.error(t)}),n.asObservable()},mt.prototype.pathForAll=function(t){void 0===t&&(t={});var e=Object.assign({},k.ParamsCollection,t),i=new dt;return i.applyParams(this,e),i.get()},mt.prototype.all=function(t){var e=this;void 0===t&&(t={});var i=Object.assign({},k.ParamsCollection,t);i.ttl||0===i.ttl||(i.ttl=this.collections_ttl);var r=new dt;r.applyParams(this,i);var n=this.getOrCreateCollection(r);n.page.number=1*i.page.number;var o=new s.BehaviorSubject(n);return 0<Object.keys(i.fields).length?this.getAllFromServer(r,i,n,o):U(n,i.ttl)?setTimeout(function(){return o.complete()},0):0===n.cache_last_update?(n.source="new",this.getAllFromLocal(i,r,n).then(function(){o.next(n),setTimeout(function(){o.complete()},0)}).catch(function(){n.setLoaded(!1),e.getAllFromServer(r,i,n,o)})):this.getAllFromServer(r,i,n,o),o.asObservable()},mt.prototype.getAllFromLocal=function(i,r,n){return void 0===i&&(i={}),yt(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:if(!rt.injectedServices.rsJsonapiConfig.cachestore_support)throw new Error("We cant handle this request");return n.setLoaded(!1),"compact"!==i.store_cache_method?[3,2]:[4,rt.injectedServices.JsonapiStoreService.getDataObject("collection",r.getForCache()+".compact")];case 1:return e=t.sent(),[3,4];case 2:return[4,(new z).getCollection(r.getForCache(),r.includes)];case 3:e=t.sent(),t.label=4;case 4:if(n.fill(e),n.setSourceAndPropagate("store"),U(n,i.ttl))return n.setLoadedAndPropagate(!0),n.setBuildedAndPropagate(!0),[2];throw new Error("Collection is dead!")}})})},mt.prototype.getAllFromServer=function(r,n,o,s){o.setLoaded(!1),rt.get(r.get()).subscribe(function(t){if(n.cachehash)for(var e in t.data){var i=t.data[e];i.id=i.id+n.cachehash}o.fill(t),o.cache_last_update=Date.now(),o.setCacheLastUpdateAndPropagate(),o.setSourceAndPropagate("server"),o.setLoadedAndPropagate(!0),rt.injectedServices.rsJsonapiConfig.cachestore_support&&(new z).saveCollection(r.getForCache(),o,r.includes),rt.injectedServices.rsJsonapiConfig.cachestore_support&&"compact"===n.store_cache_method&&rt.injectedServices.JsonapiStoreService.saveCollection(r.getForCache()+".compact",t),s.next(o),setTimeout(function(){return s.complete()},0)},function(t){o.setLoadedAndPropagate(!0),s.next(o),s.error(t)})},mt);function mt(){var t=this;this.resource=S,setTimeout(function(){return t.register()})}var _t,wt=(p(Rt,_t=S),Rt);function Rt(){var t=_t.call(this)||this;return t.attributes={name:"",date_of_birth:new Date,date_of_death:new Date,created_at:new Date,updated_at:new Date},t.relationships={books:new A,photos:new A},t.type="authors",t.ttl=0,!Rt.test_ttl&&0!==Rt.test_ttl||(t.ttl=Rt.test_ttl),t}var jt,St=(p(Ot,jt=bt),Ot);function Ot(){var t=jt.call(this)||this;return t.resource=wt,t.type="authors",t.collections_ttl=0,t.register(),t}var Ct,Pt=(p(Dt,Ct=S),Dt);function Dt(){var t=Ct.call(this)||this;return t.attributes={date_published:new Date,title:"",created_at:new Date,updated_at:new Date},t.relationships={author:new J,photos:new A},t.type="books",t.ttl=0,!Dt.test_ttl&&0!==Dt.test_ttl||(t.ttl=Dt.test_ttl),t}var Et,xt=(p(At,Et=bt),At);function At(){var t=Et.call(this)||this;return t.type="books",t.resource=Pt,t.collections_ttl=0,t.register(),t}var Ft,kt=(p(It,Ft=S),It);function It(){var t=Ft.call(this)||this;return t.attributes={title:"",uri:"",imageable_id:"",created_at:new Date,updated_at:new Date},t.type="photos",t.ttl=0,!It.test_ttl&&0!==It.test_ttl||(t.ttl=It.test_ttl),t}var Lt,Tt=(p(qt,Lt=bt),qt);function qt(){var t=Lt.call(this)||this;return t.resource=kt,t.type="photos",t.register(),t}var Jt=(Mt.getResourceDocumentData=function(t,e,i){void 0===e&&(e=[]);var r=this["get"+t.name](i,e).toObject();return Mt.fillDocumentDataIncludedRelatioships(r,e),r},Mt.getCollectionDocumentData=function(t,e,i){void 0===e&&(e=2),void 0===i&&(i=[]);var r=this.getCollection(t,e,i).toObject();return Mt.fillDocumentDataIncludedRelatioships(r,i),r},Mt.getBookDocumentData=function(){},Mt.getPhotoDocumentData=function(){},Mt.getBook=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=0);var r=new Pt;return r.id=this.getId(t),r.ttl=i,Mt.fillBookAttributes(r),r.relationships.author.data=this.getDataResourceWithType("authors"),e.includes("author")&&this.includeFromService(r,"author",wt),r.relationships.photos.data=r.relationships.photos.data.concat(this.getDataResourcesWithType("photos",2)),e.includes("photos")&&this.includeFromService(r,"photos",kt),r},Mt.getAuthor=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=0);var r=new wt;if(r.id=this.getId(t),r.ttl=i,Mt.fillAuthorAttributes(r),r.relationships.books.data=r.relationships.books.data.concat(this.getDataResourcesWithType("books",2)),e.includes("books")){this.includeFromService(r,"books",Pt);for(var n=0,o=r.relationships.books.data;n<o.length;n++)o[n].relationships.author.data.id=r.id}return r.relationships.photos.data=r.relationships.photos.data.concat(this.getDataResourcesWithType("photos",2)),e.includes("photos")&&this.includeFromService(r,"photos",kt),r},Mt.getPhoto=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=0);var r=new kt;return r.id=this.getId(t),r.ttl=i,Mt.fillPhotoAttirbutes(r),r},Mt.getCollection=function(t,e,i){void 0===e&&(e=2),void 0===i&&(i=[]);for(var r=new A,n=0;n<e;n++){var o=this["get"+t.name](void 0,i);r.data.push(o)}return r.setBuilded(!0),r.setLoaded(!0),r.cache_last_update=Date.now(),r},Mt.fillAuthorAttributes=function(t){return t.attributes.name=l.name.firstName(),t.attributes.date_of_birth=l.date.past(),t.attributes.date_of_death=l.date.past(),t.attributes.created_at=l.date.past(),t.attributes.updated_at=l.date.past(),t},Mt.fillBookAttributes=function(t){return t.attributes.title=l.name.title(),t.attributes.date_published=l.date.past(),t.attributes.created_at=l.date.past(),t.attributes.updated_at=l.date.past(),t},Mt.fillPhotoAttirbutes=function(t){return t.attributes.title=l.name.title(),t.attributes.uri=l.internet.url(),t.attributes.imageable_id=l.random.uuid(),t.attributes.created_at=l.date.past(),t.attributes.updated_at=l.date.past(),t},Mt.getId=function(t){return t||"new_"+Math.floor(1e4*Math.random()).toString()},Mt.includeFromService=function(t,e,i){var r=t.relationships[e];r?r.data&&"id"in r.data?this.includeHasOneFromService(t,e,i):r instanceof A&&this.includeHasManyFromService(t,e,i):console.error(e+" relationship doesn't exist in "+t.type)},Mt.includeHasOneFromService=function(t,e,i){var r=new i,n=t.relationships[e];n&&n.data&&(r.id=n.data.id,Mt["fill"+i.name+"Attributes"](r),t.addRelationship(r,e))},Mt.includeHasManyFromService=function(t,e,i){for(var r=[],n=0,o=t.relationships[e].data;n<o.length;n++){var s=o[n],a=new i;a.id=s.id,Mt["fill"+i.name+"Attributes"](a),r.push(a)}t.relationships[e].data=r},Mt.getDataResourceWithType=function(t,e){return{id:this.getId(e),type:t}},Mt.getDataResourcesWithType=function(t,e){for(var i=[],r=0;r<e;r++)i.push(this.getDataResourceWithType(t));return i},Mt.fillResourceRelationshipsInDocumentData=function(t,e,i){t.included||(t.included=[]);var r=e.relationships[i];if(r instanceof J||"type"in r.data){var n=r.data;if(!n)return void console.warn("relationship content is empty");var o=Mt.resource_classes_by_type[n.type];if(!o)return void console.warn("cannot find the required class for type "+n.type);t.included.push(this["get"+o.name](n.id))}else if(r instanceof A||r.data instanceof Array)for(var s=0,a=e.relationships[i].data;s<a.length;s++){var c=a[s];t.included.push(this["get"+Mt.resource_classes_by_type[c.type].name](c.id))}},Mt.fillDocumentDataIncludedRelatioships=function(t,e){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t.included||(t.included=[]),t.data.id){if(!t.data.relationships[n].data)continue;return void Mt.fillResourceRelationshipsInDocumentData(t,t.data,n)}for(var o=0,s=t.data;o<s.length;o++){var a=s[o];Mt.fillResourceRelationshipsInDocumentData(t,a,n)}}},Mt);function Mt(){}Jt.resource_classes_by_type={photos:kt,books:Pt,authors:wt},t.Autoregister=function(){return function(t){}},t.JsonapiCore=rt,t.Resource=S,t.DocumentResource=J,t.DocumentCollection=A,t.Service=bt,t.Author=wt,t.AuthorsService=St,t.Book=Pt,t.BooksService=xt,t.Photo=kt,t.PhotosService=Tt,t.TestFactory=Jt,t.NgxJsonapiModule=ot,t.ɵe=C,t.ɵa=D,t.ɵb=Q,t.ɵd=V,t.ɵc=Z,Object.defineProperty(t,"__esModule",{value:!0})});